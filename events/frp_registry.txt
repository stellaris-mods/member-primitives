namespace = fp_registry

# CREATE REGISTRY
country_event = {
	id = fp_registry.9001 # IT IS OVER 9000!
	hide_window = yes

	# Apparently this means it will only trigger once, per game, across savegames
	fire_only_once = yes

	mean_time_to_happen = {
		days = 2
	}

	immediate = {
		every_country = {
			limit = {
				is_country_type = "primitive"
				NOT = { has_country_flag = "fp_was_ever_primitive" }
			}
			set_country_flag = "fp_was_ever_primitive"
		}
	}
}

# This event runs on every country_event, for the whole game.
country_event = {
	id = fp_registry.1
	hide_window = yes
	trigger = {
		is_country_type = "default"
		has_country_flag = "fp_was_ever_primitive"
	}
	immediate = {
		# This civ has moved from primitive to default, notify the addon
		remove_country_flag = "fp_was_ever_primitive"
		capital_scope = {
			every_country = {
				limit = {
					is_country_type = "default"
					is_ai = no
				}
				# Prev needs to be planet, and must be ran from country scope
				fp_cancel_all_types = yes
			}
		}
	}
}

planet_event = {
	id = fp_registry.200
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = from
		# Dont check if FROM is a primitive country, just
		# cancel all projects, if any, regardless.
	}

	immediate = {
		every_country = {
			limit = {
				is_country_type = "default"
				is_ai = no
			}
			# We are in the player country scope
			# Prev needs to be planet, and must be ran from player country scope
			fp_cancel_all_types = yes
		}
	}
}

#on_country_destroyed
country_event = {
	id = fp_registry.300
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		exists = capital_scope
	}

	immediate = {
		capital_scope = {
			every_country = {
				limit = {
					is_country_type = "default"
					is_ai = no
				}
				# We are in the player country scope
				# Prev needs to be planet, and must be ran from player country scope
				fp_cancel_all_types = yes
			}
		}
	}
}

#on_colony_destroyed
planet_event = {
	id = fp_registry.400
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		every_country = {
			limit = {
				is_country_type = "default"
				is_ai = no
			}
			# We are in the player country scope
			# Prev needs to be planet, and must be ran from player country scope
			fp_cancel_all_types = yes
		}
	}
}
